<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js"></script>

    <!-- import -->
    <script src="components/dialog.js"></script>
    <script src="components/overview.js"></script>

    <title>RECCON plotting test</title>
    <style>
        body {
            background: #eee;
            overflow-y: scroll;
        }

        .container {
            width: 850px;
            background: white;
        }

        .brushed {
            stroke-width: 1;
            stroke: gray;
            r: 5;
        }

        .utterance {
            font-size: 14px;
        }

    </style>
<body>
    <header>
        <nav class="container navbar navbar-light bg-light">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1">Dialog plot</span>
            </div>
        </nav>

    </header>
    <main class="container pb-3"><div class="row pt-2">
        <div class="col-2 text-end pe-2"><strong>정렬 기준:</strong></div>
            <div class="col-10">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sorting-criteria" value="length" id="sc-len"
                        checked>
                    <label class="form-check-label" for="x-sl">대화 길이</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="sorting-criteria" value="emotion" id="sc-emo">
                    <label class="form-check-label" for="x-sw">대화 감정</label>
                </div>
            </div>
        </div>
        <div class="row">
            <svg width="100%" height="300" id="overview">
                <rect width="100%" height="100%" fill="white" stroke="black" stroke-width="2">

                </rect>
            </svg>
            <div class="tooltip bs-tooltip-top show" id="overview-tooltip" role="tooltip" style="display:none">
                <div class="tooltip-arrow"></div>
                <div class="tooltip-inner">
                    Some tooltip text!
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col text-lg-end">
                <nav class="navbar navbar-light bg-light">
                    <div class="fluid">
                        <span class="text-center navbar-brand mb-0 h1" id="dialog_num">Dialog: </span>
                    </div>
                </nav>
                <div style="width: 420px; height: 450px; overflow-y: scroll;">
                    <svg width="100%" height="100%" id="dialog">
                        <rect width="100%" height="100%" fill="white" stroke="black" stroke-width="2">
        
                        </rect>
                    </svg>
                </div>
            </div>
            <div class="col text-lg-start">
                <svg width="100%" height="500" id="graph">
                    <rect width="100%" height="100%" fill="white" stroke="black" stroke-width="2">
    
                    </rect>
                </svg>
            </div>
        </div>
    </main>
    <script>
        let data, dialog, overview;
        let filepath = "http://localhost:8000/dailydialog_table_all.csv";
        let filepath_overview = "http://localhost:8000/dailydialog_table.csv";
        
        let did = "tr_4466"

        function updateDialog() {
            dialog.update(did);

            // #dialog_num의 text를 업데이트
            d3.select("#dialog_num").text("Dialog: " + did);
        }
        function updateOverview() {
            overview.update();
        }

        // CSV 파일 경로
        const csvFilePath = filepath;
        let datas_all = [];
        let datas_overview = [];
        
        // 파일 불러오기
        d3.csv(filepath) // 파일 1에 대해서 update (#dialog, #graph)
            .then(csvData => {
                csvData.forEach(d => {
                    datas_all.push(d)
                });
                data_all = datas_all;
                dialog = new Dialog("#dialog", data_all);
                dialog.update();

                updateDialog();

            })
        
        d3.csv(filepath_overview) // 파일 2에 대해서 update (#overview)
            .then(csvData_overview => {
                csvData_overview.forEach(d => {
                    datas_overview.push(d)
                });
                datas_overview = datas_overview;
                overview = new Overview("#overview", '#overview-tooltip', datas_overview);
                overview.update();

                updateOverview();

            })


    </script>
</body>